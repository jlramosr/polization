
<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="josito-pointer-events">

  <template>

    <style>
      #canvas {
        width: 400px;
        border: 1px solid black;
        height: 400px;
        position: relative;
        /* 
         * Disable predetermined touch events (user agent is new manager).
         *
         * It's used to allow pointer events.
         * User agent is the new manager and it listens events of user agent like pointer events.
         */ 
         touch-action: none;
      }

      #subcanvas {
        width: 200px;
        border: 1px solid red;
        height: 200px;
        margin: 100px;
      }

      #board {
        position: absolute;
        border: 1px solid green;
        width: 100px;
        height: 100px;
        top: 150px;
        left: 150px;
      }

      .bolita {
        position: absolute;
        top: 0;
        left: 0;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        background-color: blue;
        opacity: 0.8;
      }

      .bolita--pointerover {
        opacity: 1;
      }

      .bolita--pointerdown {
        background-color: darkblue;
      }

    </style>


    
    <div id="board">
      <div id="bolita" class="bolita" on-pointerdown="_onPointerDownBolita"></div>
    </div>
 

  </template>

  <script>

    Polymer({

      is: 'josito-pointer-events',

      properties: {

        bolitaDown: {
          type: Boolean,
          value: false,
          observer: '_bolitaDownChanged'
        }

      },

      attached() {
        // this.$.canvas.addEventListener('click', this._onClickCanvas);
        // this.$.subcanvas.addEventListener('click', this._onClickSubcanvas);
        // this.$.Board.addEventListener('click', this._onClickBoard);
        // this.$.canvas.addEventListener('contextmenu', this._onRightClickCanvas);
        // this.$.subcanvas.addEventListener('contextmenu', this._onRightClickSubcanvas);
        // this.$.Board.addEventListener('contextmenu', this._onRightClickBoard);
        // this.$.canvas.addEventListener('touchend', this._onTouchEndCanvas);
        // this.$.subcanvas.addEventListener('touchend', this._onTouchEndSubcanvas);
        // this.$.Board.addEventListener('touchend', this._onTouchEndBoard);
        // this.$.canvas.addEventListener('touchstart', this._onTouchStartCanvas);
        // this.$.subcanvas.addEventListener('touchstart', this._onTouchStartSubcanvas);
        // this.$.Board.addEventListener('touchstart', this._onTouchStartBoard);
        // this.$.canvas.addEventListener('touchmove', this._onTouchMoveCanvas);
        // this.$.subcanvas.addEventListener('touchmove', this._onTouchMoveSubcanvas);
        // this.$.Board.addEventListener('touchmove', this._onTouchMoveBoard);

        // this.$.canvas.addEventListener('pointerover', this._onPointerOverCanvas);
        // this.$.subcanvas.addEventListener('pointerover', this._onPointerOverSubcanvas);
        // this.$.Board.addEventListener('pointerover', this._onPointerOverBoard);
        // this.$.canvas.addEventListener('pointerout', this._onPointerOutCanvas);
        // this.$.subcanvas.addEventListener('pointerout', this._onPointerOutSubcanvas);
        // this.$.Board.addEventListener('pointerout', this._onPointerOutBoard);
        // this.$.canvas.addEventListener('pointermove', this._onPointerMoveCanvas);
        // this.$.subcanvas.addEventListener('pointermove', this._onPointerMoveSubcanvas);
        // this.$.Board.addEventListener('pointermove', this._onPointerMoveBoard);
        // this.$.canvas.addEventListener('pointerup', this._onPointerUpCanvas);
        // this.$.subcanvas.addEventListener('pointerup', this._onPointerUpSubcanvas);
        // this.$.Board.addEventListener('pointerup', this._onPointerUpBoard);
        // this.$.canvas.addEventListener('pointerdown', this._onPointerDownCanvas);
        // this.$.subcanvas.addEventListener('pointerdown', this._onPointerDownSubcanvas);
        // this.$.Board.addEventListener('pointerdown', this._onPointerDownBoard);
        // this.$.canvas.addEventListener('pointerenter', this._onPointerEnter);
        // this.$.canvas.addEventListener('pointermove', this._onPointerMoveCanvas);
        // this.$.canvas.addEventListener('pointercancel', this._onPointerCancel);
        // this.$.canvas.addEventListener('pointerleave', this._onPointerLeave);
        // this.$.canvas.addEventListener('gotpointercapture', this._onGotPointerCapture);
        // this.$.canvas.addEventListener('lostpointercapture', this._onLostPointerCapture); 
      },

      _onPointerDownBolita(event) {
        const bolita = event.currentTarget;
        if (event.pointerType == 'mouse') {
          this.bolitaDown = true;
          bolita.classList.add('bolita--pointerdown');
          this.$.board.addEventListener('pointermove', ev => {
            if (this.bolitaDown) {
              console.log("SE ESTA MOVIENDO LA BOLITA POR EL BOARD", ev);
              const animation = bolita.animate([
                { 'transform': `translate(0px, 0px)` }, 
                { 'transform': `translate(${event.screenX}px, ${event.screenY}px)` }
              ], { 
                duration: 5000,
              });
              //mirar translate3d https://github.com/sharedlabs/sortable-list/blob/master/sortable-list.html
              animation.onfinish = _ => {
              };
            }
          });
          this.$.board.addEventListener('pointerup', ev => {
            if (this.bolitaDown) {
              console.log("SE HA DEJADO DE MOVER LA BOLITA POR EL BOARD", ev);
              this.bolitaDown = false;
              bolita.classList.remove('bolita--pointerdown'); 
            }
          });
        }
      },

      _onPointerUpBolita(event) {
        if (event.pointerType == 'mouse') {
          this.bolitaDown = false;
          event.currentTarget.classList.remove('bolita--pointerdown');
        }
      },

      _onPointerOverBolita(event) {
        if (event.pointerType == 'mouse') {
          event.currentTarget.classList.add('bolita--pointerover');
        }
      },

      _onPointerOutBolita(event) {
        if (event.pointerType == 'mouse') {
          event.currentTarget.classList.remove('bolita--pointerover');
        }
      },

      _bolitaDownChanged(bolitaDown, oldBolitaDown) {
        console.log("_bolitaDownChanged", bolitaDown, oldBolitaDown);
      },

      _onClickCanvas(event)     { console.log("Click en CANVAS", event); },
      _onClickSubcanvas(event)  { console.log("Click en SUBCANVAS", event); },
      _onClickBoard(event)  { console.log("Click en CANVAS ABSOLUTE", event); },
      _onRightClickCanvas(event)     { event.preventDefault(); console.log("Right click en CANVAS", event); },
      _onRightClickSubcanvas(event)  { event.preventDefault(); console.log("Right click en SUBCANVAS", event); },
      _onRightClickBoard(event)  { event.preventDefault(); console.log("Right click en CANVAS ABSOLUTE", event); },
      _onTouchStartCanvas(event) { console.log("Touch Start in CANVAS ONLY MOBILE", event); },
      _onTouchStartSubcanvas(event) { console.log("Touch Start in SUBCANVAS ONLY MOBILE", event); },
      _onTouchStartBoard(event) { console.log("Touch Start in CANVAS ABSOLUTE ONLY MOBILE", event); },
      _onTouchEndCanvas(event) { console.log("Touch Start and End in CANVAS ONLY MOBILE", event); },
      _onTouchEndSubcanvas(event) { console.log("Touch Start and End in SUBCANVAS ONLY MOBILE", event); },
      _onTouchEndBoard(event) { console.log("Touch Start and End in CANVAS ABSOLUTE ONLY MOBILE", event); },
      _onTouchLeaveCanvas(event) { console.log("Touch Leave in CANVAS ONLY MOBILE", event); },
      _onTouchLeaveSubcanvas(event) { console.log("Touch Leave in SUBCANVAS ONLY MOBILE", event); },
      _onTouchLeaveBoard(event) { console.log("Touch Leave in CANVAS ABSOLUTE ONLY MOBILE", event); },
      _onTouchMoveCanvas(event) { console.log("Touch Move in CANVAS ONLY MOBILE y touch-action: auto", event); },
      _onTouchMoveSubcanvas(event) { console.log("Touch Move  in SUBCANVAS ONLY MOBILE y touch-action: auto", event); },
      _onTouchMoveBoard(event) { console.log("Touch Move in CANVAS ABSOLUTE ONLY MOBILE y touch-action: auto", event); },

      _onPointerOverCanvas(event) { console.log("Pointer Over in CANVAS", event.pointerType); },
      _onPointerOverSubcanvas(event) { console.log("Pointer Over in SUBCANVAS", event.pointerType); },
      _onPointerOverBoard(event) { console.log("Pointer Over in CANVAS ABSOLUTE", event.pointerType); },
      _onPointerOutCanvas(event) { console.log("Pointer Out in CANVAS", event.pointerType); },
      _onPointerOutSubcanvas(event) { console.log("Pointer Out in SUBCANVAS", event.pointerType); },
      _onPointerOutBoard(event) { console.log("Pointer Out in CANVAS ABSOLUTE", event.pointerType); },
      /*_onPointerMoveCanvas(event) { console.log("Pointer Move in CANVAS", event.pointerType); },
      _onPointerMoveSubcanvas(event) { console.log("Pointer Move in SUBCANVAS", event.pointerType); },
      _onPointerMoveBoard(event) { console.log("Pointer Move in CANVAS ABSOLUTE", event.pointerType); },*/
      _onPointerUpCanvas(event) { console.log("Pointer Up in CANVAS", event.pointerType); },
      _onPointerUpSubcanvas(event) { console.log("Pointer Up in SUBCANVAS", event.pointerType); },
      // _onPointerUpBoard(event) { console.log("Pointer Up in CANVAS ABSOLUTE", event.pointerType); },
      _onPointerDownCanvas(event) { console.log("Pointer Down in CANVAS", event.pointerType); },
      _onPointerDownSubcanvas(event) { console.log("Pointer Down in SUBCANVAS", event.pointerType); },
      _onPointerDownBoard(event) { console.log("Pointer Down in CANVAS ABSOLUTE", event.pointerType); },

      _onPointerEnter(event) {
        console.log("_onPointerEnter", event);
      },
      _onPointerCancel(event) {
        console.log("_onPointerCancel", event);
      },
      _onPointerLeave(event) {
        console.log("_onPointerLeave", event);
      },
      _onGotPointerCapture(event) {
        console.log("_onGotPointerCapture", event);
      },
      _onLostPointerCapture(event) {
        console.log("_onLostPointerCapture", event);
      },

    });

  </script>

</dom-module>
