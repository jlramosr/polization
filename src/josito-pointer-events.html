
<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="josito-pointer-events">

  <template>

    <style>
      #canvas {
        width: 400px;
        border: 1px solid black;
        height: 400px;
        position: relative;
        /* 
         * Disable predetermined touch events (user agent is new manager).
         *
         * It's used to allow pointer events.
         * User agent is the new manager and it listens events of user agent like pointer events.
         */ 
         touch-action: none;
      }

      #subcanvas {
        width: 200px;
        border: 1px solid red;
        height: 200px;
        margin: 100px;
      }

      #board {
        position: absolute;
        border: 1px solid green;
        width: 100px;
        height: 100px;
        top: 150px;
        left: 150px;
      }

      .bolita {
        position: absolute;
        top: 0;
        left: 0;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        background-color: blue;
        opacity: 0.5;
      }

      :host([bolita-selected]) .bolita {
        opacity: 1;
        user-select: none;
        -moz-user-select: none;
        -khtml-user-select: none;
        -webkit-user-select: none;
        /* Required to make elements draggable in old WebKit */
        -khtml-user-drag: element;
        -webkit-user-drag: element;
        cursor: grabbing;
        cursor: -moz-grabbing;
        cursor: -webkit-grabbing;
      }

      :host([bolita-dragging]) .bolita {
        display: none;
        cursor: grabbing;
        cursor: -moz-grabbing;
        cursor: -webkit-grabbing;
      }

    </style>


    
    <div id="board" class="board">
      <div 
        id="bolita" 
        class="bolita"
        on-tap="_onTapBolita"></div>
    </div>


  </template>

  <script>

    Polymer({

      is: 'josito-pointer-events',

      properties: {

        bolitaSelected: {
          type: Boolean,
          reflectToAttribute: true,
          readOnly: true,
          value: false,
        },

        bolitaDragging: {
          type: Boolean,
          reflectToAttribute: true,
          readOnly: true,
          value: false
        },

        positionX: Number,

        positionY: Number

      },

      listeners: {
        'drag': '_onStartDragBolita',
        'dragend': '_onEndDragBolita'
      },

      attached() {
        //  this.$.canvas.addEventListener('click', this._onClickCanvas);
        // this.$.subcanvas.addEventListener('click', this._onClickSubcanvas);
        //  this.$.board.addEventListener('click', this._onClickBoard);
        // this.$.canvas.addEventListener('contextmenu', this._onRightClickCanvas);
        // this.$.subcanvas.addEventListener('contextmenu', this._onRightClickSubcanvas);
        // this.$.Board.addEventListener('contextmenu', this._onRightClickBoard);
        // this.$.canvas.addEventListener('touchend', this._onTouchEndCanvas);
        // this.$.subcanvas.addEventListener('touchend', this._onTouchEndSubcanvas);
        // this.$.Board.addEventListener('touchend', this._onTouchEndBoard);
        // this.$.canvas.addEventListener('touchstart', this._onTouchStartCanvas);
        // this.$.subcanvas.addEventListener('touchstart', this._onTouchStartSubcanvas);
        // this.$.Board.addEventListener('touchstart', this._onTouchStartBoard);
        // this.$.canvas.addEventListener('touchmove', this._onTouchMoveCanvas);
        // this.$.subcanvas.addEventListener('touchmove', this._onTouchMoveSubcanvas);
        // this.$.Board.addEventListener('touchmove', this._onTouchMoveBoard);

        // this.$.canvas.addEventListener('pointerover', this._onPointerOverCanvas);
        // this.$.subcanvas.addEventListener('pointerover', this._onPointerOverSubcanvas);
        // this.$.Board.addEventListener('pointerover', this._onPointerOverBoard);
        // this.$.canvas.addEventListener('pointerout', this._onPointerOutCanvas);
        // this.$.subcanvas.addEventListener('pointerout', this._onPointerOutSubcanvas);
        // this.$.Board.addEventListener('pointerout', this._onPointerOutBoard);
        // this.$.canvas.addEventListener('pointermove', this._onPointerMoveCanvas);
        // this.$.subcanvas.addEventListener('pointermove', this._onPointerMoveSubcanvas);
        // this.$.Board.addEventListener('pointermove', this._onPointerMoveBoard);
        // this.$.canvas.addEventListener('pointerup', this._onPointerUpCanvas);
        // this.$.subcanvas.addEventListener('pointerup', this._onPointerUpSubcanvas);
        // this.$.Board.addEventListener('pointerup', this._onPointerUpBoard);
        // this.$.canvas.addEventListener('pointerdown', this._onPointerDownCanvas);
        // this.$.subcanvas.addEventListener('pointerdown', this._onPointerDownSubcanvas);
        // this.$.Board.addEventListener('pointerdown', this._onPointerDownBoard);
        // this.$.canvas.addEventListener('pointerenter', this._onPointerEnter);
        // this.$.canvas.addEventListener('pointermove', this._onPointerMoveCanvas);
        // this.$.canvas.addEventListener('pointercancel', this._onPointerCancel);
        // this.$.canvas.addEventListener('pointerleave', this._onPointerLeave);
        // this.$.canvas.addEventListener('gotpointercapture', this._onGotPointerCapture);
        // this.$.canvas.addEventListener('lostpointercapture', this._onLostPointerCapture); 
      },

      _onTapBolita(event) {
        const bolita = event.currentTarget;
        this.bolitaSelected ? this._setBolitaSelected(false) : this._setBolitaSelected(true); 
      },

      _onStartDragBolita(event) {

        if (!this.bolitaDragging) {

          this.positionX = event.screenX;
          this.positionY = event.screenY;

          console.log("START DRAGGING", this.positionX, this.positionY, this.$.bolita.stye.left );
          event.preventDefault();
          this._setBolitaDragging(true);

          this.$.board.addEventListener('dragover', ev => {
            console.log("DRAGGING OVER BOARD");
            event.preventDefault();
          }); 

        }
      },

      _onEndDragBolita(event) {
        console.log("FINISH DRAGGING", this);
        this._setBolitaDragging(false);
        const endPositionX = event.screenX - this.positionX;
        const endPositionY = event.screenY - this.positionY; 
        console.log("EMPEZÓ EN", this.positionX, this.positionY, "TERMINÓ EN", event.screenX, event.screenY, "POR LO TANTO MOVER", endPositionX, endPositionY);
        this.translate3d(endPositionX + 'px', endPositionY + 'px','1px', this.$.bolita);
      },

      _onDragOverBoard(event) {
        if (this.bolitaDragging) {
          console.log("DRAGGING OVER BOARD");
          event.preventDefault();
          this.translate3d('50px','0px','500px', this.$.bolita);
        }
      },

      _onPointerDownBolita(event) {
        /*const bolita = event.currentTarget;
        if (event.pointerType == 'mouse') {
          this._setDragging(true);
          bolita.classList.add('bolita--pointerdown');
          if ('vibrate' in navigator) {
            navigator.vibrate(30);
          }
          this.$.board.addEventListener('pointermove', ev => {
            if (this.dragging) {
              this.translate3d('0px','0px','500px', bolita);
            }
          });
          this.$.board.addEventListener('pointerup', ev => {
            if (this.dragging) {
              this._setDragging(false);
              bolita.classList.remove('bolita--pointerdown'); 
            }
          });
        }*/
      },

      _onPointerUpBolita(event) {
        if (event.pointerType == 'mouse') {
          this.dragging = false;
          event.currentTarget.classList.remove('bolita--pointerdown');
        }
      },

      _onPointerOverBolita(event) {
        if (event.pointerType == 'mouse') {
          event.currentTarget.classList.add('bolita--pointerover');
        }
      },

      _onPointerOutBolita(event) {
        if (event.pointerType == 'mouse') {
          event.currentTarget.classList.remove('bolita--pointerover');
        }
      },

      _draggingChanged(dragging, olddragging) {
        // console.log("_draggingChanged", dragging, olddragging);
      },

      _onClickCanvas(event)     { console.log("Click en CANVAS", event); },
      _onClickSubcanvas(event)  { console.log("Click en SUBCANVAS", event); },
      _onClickBoard(event)  { event.stopPropagation(); console.log("Click en CANVAS ABSOLUTE", event); },
      _onRightClickCanvas(event)     { event.preventDefault(); console.log("Right click en CANVAS", event); },
      _onRightClickSubcanvas(event)  { event.preventDefault(); console.log("Right click en SUBCANVAS", event); },
      _onRightClickBoard(event)  { event.preventDefault(); console.log("Right click en CANVAS ABSOLUTE", event); },
      _onTouchStartCanvas(event) { console.log("Touch Start in CANVAS ONLY MOBILE", event); },
      _onTouchStartSubcanvas(event) { console.log("Touch Start in SUBCANVAS ONLY MOBILE", event); },
      _onTouchStartBoard(event) { console.log("Touch Start in CANVAS ABSOLUTE ONLY MOBILE", event); },
      _onTouchEndCanvas(event) { console.log("Touch Start and End in CANVAS ONLY MOBILE", event); },
      _onTouchEndSubcanvas(event) { console.log("Touch Start and End in SUBCANVAS ONLY MOBILE", event); },
      _onTouchEndBoard(event) { console.log("Touch Start and End in CANVAS ABSOLUTE ONLY MOBILE", event); },
      _onTouchLeaveCanvas(event) { console.log("Touch Leave in CANVAS ONLY MOBILE", event); },
      _onTouchLeaveSubcanvas(event) { console.log("Touch Leave in SUBCANVAS ONLY MOBILE", event); },
      _onTouchLeaveBoard(event) { console.log("Touch Leave in CANVAS ABSOLUTE ONLY MOBILE", event); },
      _onTouchMoveCanvas(event) { console.log("Touch Move in CANVAS ONLY MOBILE y touch-action: auto", event); },
      _onTouchMoveSubcanvas(event) { console.log("Touch Move  in SUBCANVAS ONLY MOBILE y touch-action: auto", event); },
      _onTouchMoveBoard(event) { console.log("Touch Move in CANVAS ABSOLUTE ONLY MOBILE y touch-action: auto", event); },

      _onPointerOverCanvas(event) { console.log("Pointer Over in CANVAS", event.pointerType); },
      _onPointerOverSubcanvas(event) { console.log("Pointer Over in SUBCANVAS", event.pointerType); },
      _onPointerOverBoard(event) { console.log("Pointer Over in CANVAS ABSOLUTE", event.pointerType); },
      _onPointerOutCanvas(event) { console.log("Pointer Out in CANVAS", event.pointerType); },
      _onPointerOutSubcanvas(event) { console.log("Pointer Out in SUBCANVAS", event.pointerType); },
      _onPointerOutBoard(event) { console.log("Pointer Out in CANVAS ABSOLUTE", event.pointerType); },
      /*_onPointerMoveCanvas(event) { console.log("Pointer Move in CANVAS", event.pointerType); },
      _onPointerMoveSubcanvas(event) { console.log("Pointer Move in SUBCANVAS", event.pointerType); },
      _onPointerMoveBoard(event) { console.log("Pointer Move in CANVAS ABSOLUTE", event.pointerType); },*/
      _onPointerUpCanvas(event) { console.log("Pointer Up in CANVAS", event.pointerType); },
      _onPointerUpSubcanvas(event) { console.log("Pointer Up in SUBCANVAS", event.pointerType); },
      // _onPointerUpBoard(event) { console.log("Pointer Up in CANVAS ABSOLUTE", event.pointerType); },
      _onPointerDownCanvas(event) { console.log("Pointer Down in CANVAS", event.pointerType); },
      _onPointerDownSubcanvas(event) { console.log("Pointer Down in SUBCANVAS", event.pointerType); },
      _onPointerDownBoard(event) { console.log("Pointer Down in CANVAS ABSOLUTE", event.pointerType); },

      _onPointerEnter(event) {
        console.log("_onPointerEnter", event);
      },
      _onPointerCancel(event) {
        console.log("_onPointerCancel", event);
      },
      _onPointerLeave(event) {
        console.log("_onPointerLeave", event);
      },
      _onGotPointerCapture(event) {
        console.log("_onGotPointerCapture", event);
      },
      _onLostPointerCapture(event) {
        console.log("_onLostPointerCapture", event);
      },

    });

  </script>

</dom-module>
